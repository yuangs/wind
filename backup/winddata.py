# -*- coding: utf-8 -*-
"""
Spyder Editor

This is a temporary script file.
"""

import pandas as pd
import re
from WindPy import *

w.start()
#code='AU12.SHF,AU01.SHF,AU02.SHF,AU04.SHF,AU06.SHF,AU08.SHF,AU10.SHF,AL12.SHF,AL01.SHF,AL02.SHF,AL03.SHF,AL04.SHF,AL05.SHF,AL06.SHF,AL07.SHF,AL08.SHF,AL09.SHF,AL10.SHF,AL11.SHF,NI12.SHF,NI01.SHF,NI02.SHF,NI03.SHF,NI04.SHF,NI05.SHF,NI06.SHF,NI07.SHF,NI08.SHF,NI09.SHF,NI10.SHF,NI11.SHF,PB12.SHF,PB01.SHF,PB02.SHF,PB03.SHF,PB04.SHF,PB05.SHF,PB06.SHF,PB07.SHF,PB08.SHF,PB09.SHF,PB10.SHF,PB11.SHF,CU12.SHF,CU01.SHF,CU02.SHF,CU03.SHF,CU04.SHF,CU05.SHF,CU06.SHF,CU07.SHF,CU08.SHF,CU09.SHF,CU10.SHF,CU11.SHF,SN12.SHF,SN01.SHF,SN02.SHF,SN03.SHF,SN04.SHF,SN05.SHF,SN06.SHF,SN07.SHF,SN08.SHF,SN09.SHF,SN10.SHF,SN11.SHF,ZN12.SHF,ZN01.SHF,ZN02.SHF,ZN03.SHF,ZN04.SHF,ZN05.SHF,ZN06.SHF,ZN07.SHF,ZN08.SHF,ZN09.SHF,ZN10.SHF,ZN11.SHF,AG12.SHF,AG01.SHF,AG02.SHF,AG03.SHF,AG04.SHF,AG05.SHF,AG06.SHF,AG07.SHF,AG08.SHF,AG09.SHF,AG10.SHF,AG11.SHF,BU12.SHF,BU01.SHF,BU02.SHF,BU03.SHF,BU04.SHF,BU05.SHF,BU06.SHF,BU09.SHF,RB12.SHF,RB01.SHF,RB02.SHF,RB03.SHF,RB04.SHF,RB05.SHF,RB06.SHF,RB07.SHF,RB08.SHF,RB09.SHF,RB10.SHF,RB11.SHF,FU02.SHF,FU03.SHF,FU04.SHF,FU05.SHF,FU06.SHF,FU07.SHF,FU08.SHF,FU09.SHF,FU10.SHF,FU11.SHF,FU12.SHF,HC12.SHF,HC01.SHF,HC02.SHF,HC03.SHF,HC04.SHF,HC05.SHF,HC06.SHF,HC07.SHF,HC08.SHF,HC09.SHF,HC10.SHF,HC11.SHF,WR12.SHF,WR01.SHF,WR02.SHF,WR03.SHF,WR04.SHF,WR05.SHF,WR06.SHF,WR07.SHF,WR08.SHF,WR09.SHF,WR10.SHF,WR11.SHF,RU01.SHF,RU03.SHF,RU04.SHF,RU05.SHF,RU06.SHF,RU07.SHF,RU08.SHF,RU09.SHF,RU10.SHF,RU11.SHF,V101.DCE,V003.DCE,V005.DCE,V007.DCE,V009.DCE,V111.DCE,B003.DCE,B007.DCE,B011.DCE,M101.DCE,M005.DCE,M008.DCE,M011.DCE,A003.DCE,A007.DCE,A011.DCE,A012.DCE,Y003.DCE,Y007.DCE,Y009.DCE,Y112.DCE,JD01.DCE,JD02.DCE,JD03.DCE,JD04.DCE,JD05.DCE,JD06.DCE,JD07.DCE,JD08.DCE,JD09.DCE,JD10.DCE,JD11.DCE,JM12.DCE,JM01.DCE,JM02.DCE,JM03.DCE,JM04.DCE,JM05.DCE,JM06.DCE,JM07.DCE,JM08.DCE,JM09.DCE,JM10.DCE,JM11.DCE,J101.DCE,J003.DCE,J005.DCE,J007.DCE,J009.DCE,J111.DCE,BB12.DCE,BB01.DCE,BB02.DCE,BB03.DCE,BB04.DCE,BB05.DCE,BB06.DCE,BB07.DCE,BB08.DCE,BB09.DCE,BB10.DCE,BB11.DCE,PP12.DCE,PP01.DCE,PP02.DCE,PP03.DCE,PP04.DCE,PP05.DCE,PP06.DCE,PP07.DCE,PP08.DCE,PP09.DCE,PP10.DCE,PP11.DCE,L101.DCE,L003.DCE,L005.DCE,L007.DCE,L009.DCE,L111.DCE,I101.DCE,I003.DCE,I005.DCE,I007.DCE,I009.DCE,I111.DCE,FB12.DCE,FB01.DCE,FB02.DCE,FB03.DCE,FB04.DCE,FB05.DCE,FB06.DCE,FB07.DCE,FB08.DCE,FB09.DCE,FB10.DCE,FB11.DCE,C003.DCE,C007.DCE,C011.DCE,CS01.DCE,CS03.DCE,CS05.DCE,CS07.DCE,CS09.DCE,CS11.DCE,P101.DCE,P003.DCE,P005.DCE,P007.DCE,P009.DCE,P111.DCE,TA12.CZC,TA01.CZC,TA02.CZC,TA03.CZC,TA04.CZC,TA05.CZC,TA06.CZC,TA07.CZC,TA08.CZC,TA09.CZC,TA10.CZC,TA11.CZC,SR01.CZC,SR03.CZC,SR05.CZC,SR07.CZC,SR09.CZC,SR11.CZC,FG12.CZC,FG01.CZC,FG02.CZC,FG03.CZC,FG04.CZC,FG05.CZC,FG06.CZC,FG07.CZC,FG08.CZC,FG09.CZC,FG10.CZC,FG11.CZC,RM01.CZC,RM03.CZC,RM05.CZC,RM07.CZC,RM08.CZC,RM09.CZC,RM11.CZC,OI01.CZC,OI03.CZC,OI05.CZC,OI07.CZC,OI09.CZC,OI11.CZC,RS07.CZC,RS08.CZC,RS09.CZC,RS11.CZC,ZC01.CZC,ZC02.CZC,ZC03.CZC,ZC04.CZC,ZC05.CZC,ZC06.CZC,ZC07.CZC,ZC08.CZC,ZC09.CZC,ZC10.CZC,ZC11.CZC,ZC12.CZC,SF12.CZC,SF01.CZC,SF02.CZC,SF03.CZC,SF04.CZC,SF05.CZC,SF06.CZC,SF07.CZC,SF08.CZC,SF09.CZC,SF10.CZC,SF11.CZC,MA12.CZC,MA01.CZC,MA02.CZC,MA03.CZC,MA04.CZC,MA05.CZC,MA06.CZC,MA07.CZC,MA08.CZC,MA09.CZC,MA10.CZC,MA11.CZC,JR01.CZC,JR03.CZC,JR05.CZC,JR07.CZC,JR09.CZC,JR11.CZC,SM12.CZC,SM01.CZC,SM02.CZC,SM03.CZC,SM04.CZC,SM05.CZC,SM06.CZC,SM07.CZC,SM08.CZC,SM09.CZC,SM10.CZC,SM11.CZC,PM01.CZC,PM03.CZC,PM05.CZC,PM07.CZC,PM09.CZC,PM11.CZC,WH01.CZC,WH03.CZC,WH05.CZC,WH07.CZC,WH09.CZC,WH11.CZC,LR01.CZC,LR03.CZC,LR05.CZC,LR07.CZC,LR09.CZC,LR11.CZC,RI01.CZC,RI03.CZC,RI05.CZC,RI07.CZC,RI09.CZC,RI11.CZC,CF01.CZC,CF03.CZC,CF05.CZC,CF07.CZC,CF09.CZC,CF11.CZC'
code='A00.DCE,A01.DCE,A02.DCE,A03.DCE,A04.DCE,A05.DCE,A06.DCE,A07.DCE,A08.DCE,AG00.SHF,AG01.SHF,AG02.SHF,AG03.SHF,AG04.SHF,AG05.SHF,AG06.SHF,AG07.SHF,AG08.SHF,AG09.SHF,AG10.SHF,AG11.SHF,AL00.SHF,AL01.SHF,AL02.SHF,AL03.SHF,AL04.SHF,AL05.SHF,AL06.SHF,AL07.SHF,AL08.SHF,AL09.SHF,AL10.SHF,AL11.SHF,AU00.SHF,AU01.SHF,AU02.SHF,AU03.SHF,AU04.SHF,AU05.SHF,AU06.SHF,AU07.SHF,B00.DCE,B01.DCE,B02.DCE,B03.DCE,B04.DCE,B05.DCE,BB00.DCE,BB01.DCE,BB02.DCE,BB03.DCE,BB04.DCE,BB05.DCE,BB06.DCE,BB07.DCE,BB08.DCE,BB09.DCE,BB10.DCE,BB11.DCE,BU00.SHF,BU01.SHF,BU02.SHF,BU03.SHF,BU04.SHF,BU05.SHF,BU06.SHF,BU07.SHF,BU08.SHF,BU09.SHF,BU10.SHF,BU11.SHF,C00.DCE,C01.DCE,C02.DCE,C03.DCE,C04.DCE,C05.DCE,CF00.CZC,CF01.CZC,CF02.CZC,CF03.CZC,CF04.CZC,CF05.CZC,CS00.DCE,CS01.DCE,CS02.DCE,CS03.DCE,CS04.DCE,CS05.DCE,CU00.SHF,CU01.SHF,CU02.SHF,CU03.SHF,CU04.SHF,CU05.SHF,CU06.SHF,CU07.SHF,CU08.SHF,CU09.SHF,CU10.SHF,CU11.SHF,EF00-S.C,EF01-S.C,EF02-S.C,FB00.DCE,FB01.DCE,FB02.DCE,FB03.DCE,FB04.DCE,FB05.DCE,FB06.DCE,FB07.DCE,FB08.DCE,FB09.DCE,FB10.DCE,FB11.DCE,FG00.CZC,FG01.CZC,FG02.CZC,FG03.CZC,FG04.CZC,FG05.CZC,FG06.CZC,FG07.CZC,FG08.CZC,FG09.CZC,FG10.CZC,FG11.CZC,FU00.SHF,FU01.SHF,FU02.SHF,FU03.SHF,FU04.SHF,FU05.SHF,FU06.SHF,FU07.SHF,FU08.SHF,FU09.SHF,FU10.SHF,HC00.SHF,HC01.SHF,HC02.SHF,HC03.SHF,HC04.SHF,HC05.SHF,HC06.SHF,HC07.SHF,HC08.SHF,HC09.SHF,HC10.SHF,HC11.SHF,I00.DCE,I01.DCE,I02.DCE,I03.DCE,I04.DCE,I05.DCE,I06.DCE,I07.DCE,I08.DCE,I09.DCE,I10.DCE,I11.DCE,IM00.SHF,IM01.SHF,IM02.SHF,IM03.SHF,J00.DCE,J01.DCE,J02.DCE,J03.DCE,J04.DCE,J05.DCE,J06.DCE,J07.DCE,J08.DCE,J09.DCE,J10.DCE,J11.DCE,JD00.DCE,JD01.DCE,JD02.DCE,JD03.DCE,JD04.DCE,JD05.DCE,JD06.DCE,JD07.DCE,JD08.DCE,JD09.DCE,JM00.DCE,JM01.DCE,JM02.DCE,JM03.DCE,JM04.DCE,JM05.DCE,JM06.DCE,JM07.DCE,JM08.DCE,JM09.DCE,JM10.DCE,JM11.DCE,JR00.CZC,JR01.CZC,JR02.CZC,JR03.CZC,JR04.CZC,JR05.CZC,L00.DCE,L01.DCE,L02.DCE,L03.DCE,L04.DCE,L05.DCE,L06.DCE,L07.DCE,L08.DCE,L09.DCE,L10.DCE,L11.DCE,LR00.CZC,LR01.CZC,LR02.CZC,LR03.CZC,LR04.CZC,LR05.CZC,M00.DCE,M01.DCE,M02.DCE,M03.DCE,M04.DCE,M05.DCE,M06.DCE,M07.DCE,MA00.CZC,MA01.CZC,MA02.CZC,MA03.CZC,MA04.CZC,MA05.CZC,MA06.CZC,MA07.CZC,MA08.CZC,MA09.CZC,MA10.CZC,MA11.CZC,NI00.SHF,NI01.SHF,NI02.SHF,NI03.SHF,NI04.SHF,NI05.SHF,NI06.SHF,NI07.SHF,NI08.SHF,OI00.CZC,OI01.CZC,OI02.CZC,OI03.CZC,OI04.CZC,OI05.CZC,P00.DCE,P01.DCE,P02.DCE,P03.DCE,P04.DCE,P05.DCE,P06.DCE,P07.DCE,P08.DCE,P09.DCE,P10.DCE,P11.DCE,PB00.SHF,PB01.SHF,PB02.SHF,PB03.SHF,PB04.SHF,PB05.SHF,PB06.SHF,PB07.SHF,PB08.SHF,PB09.SHF,PB10.SHF,PB11.SHF,PM00.CZC,PM01.CZC,PM02.CZC,PM03.CZC,PM04.CZC,PM05.CZC,PP00.DCE,PP01.DCE,PP02.DCE,PP03.DCE,PP04.DCE,PP05.DCE,PP06.DCE,PP07.DCE,PP08.DCE,PP09.DCE,PP10.DCE,PP11.DCE,RB00.SHF,RB01.SHF,RB02.SHF,RB03.SHF,RB04.SHF,RB05.SHF,RB06.SHF,RB07.SHF,RB08.SHF,RB09.SHF,RB10.SHF,RB11.SHF,RI00.CZC,RI01.CZC,RI02.CZC,RI03.CZC,RI04.CZC,RI05.CZC,RM00.CZC,RM01.CZC,RM02.CZC,RM03.CZC,RM04.CZC,RM05.CZC,RM06.CZC,RS00.CZC,RS01.CZC,RS02.CZC,RS03.CZC,RU00.SHF,RU01.SHF,RU02.SHF,RU03.SHF,RU04.SHF,RU05.SHF,RU06.SHF,RU07.SHF,RU08.SHF,RU09.SHF,SF00.CZC,SF01.CZC,SF02.CZC,SF03.CZC,SF04.CZC,SF05.CZC,SF06.CZC,SF07.CZC,SF08.CZC,SF09.CZC,SF10.CZC,SF11.CZC,SM00.CZC,SM01.CZC,SM02.CZC,SM03.CZC,SM04.CZC,SM05.CZC,SM06.CZC,SM07.CZC,SM08.CZC,SM09.CZC,SM10.CZC,SM11.CZC,SN00.SHF,SN01.SHF,SN02.SHF,SN03.SHF,SN04.SHF,SN05.SHF,SN06.SHF,SN07.SHF,SN08.SHF,SR00.CZC,SR01.CZC,SR02.CZC,SR03.CZC,SR04.CZC,SR05.CZC,SR06.CZC,SR07.CZC,SR08.CZC,TA00.CZC,TA01.CZC,TA02.CZC,TA03.CZC,TA04.CZC,TA05.CZC,TA06.CZC,TA07.CZC,TA08.CZC,TA09.CZC,TA10.CZC,TA11.CZC,V00.DCE,V01.DCE,V02.DCE,V03.DCE,V04.DCE,V05.DCE,V06.DCE,V07.DCE,V08.DCE,V09.DCE,V10.DCE,V11.DCE,WH00.CZC,WH01.CZC,WH02.CZC,WH03.CZC,WH04.CZC,WH05.CZC,WR00.SHF,WR01.SHF,WR02.SHF,WR03.SHF,WR04.SHF,WR05.SHF,WR06.SHF,WR07.SHF,WR08.SHF,WR09.SHF,WR10.SHF,WR11.SHF,Y00.DCE,Y01.DCE,Y02.DCE,Y03.DCE,Y04.DCE,Y05.DCE,Y06.DCE,Y07.DCE,ZC00.CZC,ZC01.CZC,ZC02.CZC,ZC03.CZC,ZC04.CZC,ZC05.CZC,ZC06.CZC,ZC07.CZC,ZC08.CZC,ZC09.CZC,ZC10.CZC,ZC11.CZC,ZN00.SHF,ZN01.SHF,ZN02.SHF,ZN03.SHF,ZN04.SHF,ZN05.SHF,ZN06.SHF,ZN07.SHF,ZN08.SHF,ZN09.SHF,ZN10.SHF,ZN11.SHF'
f=open(r"C:\Users\gsyuan\Desktop\time.txt")
datelist=re.findall('\d{8}',str(f.readlines()))


def data(date):
  date=date
  d=w.wss(code, "close,oi,sccode,trade_hiscode","tradeDate=%s;priceAdj=U;cycle=D" %date)
  df=pd.DataFrame(d.Data).T
#  df.index=d.Codess
  df.columns=d.Fields
  df['date']=date
  return df.dropna()

def datasave():
  for date in datelist:
    data(date).to_csv(r"C:\Users\gsyuan\Desktop\alldata.csv",mode='a',header=None)

datasave()


def cat(x):
  CAT=''
  if x in ['ZC','FU']:
    CAT='energy'
  elif x in ['FG','V','BB','FB']:
    CAT='construction material'
  elif x in ['CF','SR']:
    CAT='soft commodity'
  elif x in ['JD']:
    CAT='agricuture product'
  elif x in ['AU','AG']:
    CAT='precious metals'
  elif x in ['C','CS','WH','RI','ER','JR','LR','PM','WS']:
    CAT='cereal'
  elif x in ['CU','AL','PB','ZN','SN','NI']:
    CAT='nonferrous metals'
  elif x in ['RB','WR','HC','JM','J','SF','SM','I']:
    CAT='steel'
  elif x in ['TA','BU','MA','RU','L','PP']:
    CAT='chemical'
  elif x in ['M','RM','P','RO','Y','A','OI','B','RS']:
    CAT='oil and feed products'
  else:
    CAT='dont know'
  return CAT


def save():
  data=pd.read_clipboard()
  data.to_csv(r"C:\Users\gsyuan\Desktop\wind.csv",mode='a')


def wind():
  a=pd.read_clipboard().dropna().drop_duplicates()
  a.index=a.date
  b=a.iloc[:,1:]
  b.index=a.date
  grouped=b.groupby(['type','ind'])
  for key,group in grouped:
    (group['wind_c']/group.iloc[0,2]).to_csv(r"C:\Users\gsyuan\Desktop\test0.csv",mode='a')
    (group['type']).to_csv(r"C:\Users\gsyuan\Desktop\test1.csv",mode='a')
    group.to_csv(r"C:\Users\gsyuan\Desktop\test2.csv",mode='a',header=False)

def compare():
  a=pd.read_clipboard()
  a.columns=['date','open','high','low','close','amount','volume']
  a.index=re.findall('\d{8}',re.sub('-','',str(list(a.date))))
  a.close.to_clipboard()

def cal_com():
  data=pd.read_clipboard()
  data.columns=['date','code','type','name','close','amt']
  data.index=data.date
#  data.drop('date',axis=1,inplace=True)

  pivot_amt=data.pivot(index='date',columns='code',values='amt')
  pivot_close=data.pivot(index='date',columns='code',values='close')
  pivot_amt.to_csv(r"C:\Users\gsyuan\Desktop\com1.csv")
  pivot_close.to_csv(r"C:\Users\gsyuan\Desktop\com2.csv")

  raw=pd.read_csv(r"C:\Users\gsyuan\Desktop\com1.csv")
  b=pd.read_csv(r"C:\Users\gsyuan\Desktop\com2.csv")
  raw.index=raw.date
  raw.drop('date',axis=1,inplace='True')
  b.index=b.date
  b.drop('date',axis=1,inplace='True')
  a=raw.copy()
  for i in a.columns:
    id=str(i)
    a[id]=a[id]/raw.sum(axis=1)
  print(a)
  print(b)
  index=(a*b).sum(axis=1)
  print('index',index)
  index.to_clipboard()

def getwindsec():
  temp=pd.read_clipboard()
  temp['date']=temp['date']=temp.日期.map(lambda x:x.replace('-',''))
  temp['close']=temp['收盘价(元)']
  df=temp.loc[:,['date','close']]
  return df
  
def calculate_volatility(days=60):
  '将行情数据复制至剪切板后，计算给定天数的波动率'
  days=days
  data=pd.read_clipboard()
  b=data['收盘价(元)']
  data['log_return']=log(b/b.shift(1))
  sigma=data['log_return'][-(days):].describe()['std']*260**0.5
  return sigma


sig5=calculate_volatility(5)
sig20=calculate_volatility(20)
sig30=calculate_volatility(30)
sig60=calculate_volatility(60)
print(sig5,sig20,sig30,sig60)




#wind()


































